# Repository Structure

## Root Level

```
vc-verifier/
├── api/              # Backend Express API subproject
├── frontend/         # Vue.js frontend subproject
├── assets/           # Shared images (logo, screenshots for README)
├── CHANGELOG.md      # Root changelog (consolidated)
├── README.md         # Project documentation
├── LICENSE           # AGPL-3.0 license
└── docker-compose.yml # Multi-container orchestration
```

## API Subproject (`/api`)

### Source Code (`/api/src`)

```
api/src/
├── index.ts                 # Express app entry point, middleware setup
├── swagger.ts              # Swagger/OpenAPI configuration
├── types.d.ts              # Global TypeScript type definitions
│
├── routers/                # Router wrappers (thin layer)
│   ├── index.ts           # Exports all routers
│   ├── verify/index.ts    # Verification router
│   └── health/index.ts    # Health/readiness router
│
├── routes/                 # Route handlers (business logic)
│   ├── index.ts           # Exports all route handlers
│   ├── verify/index.ts    # VerifyRoutes class with handlers
│   └── health/index.ts    # Health check handlers
│
├── services/              # Core business logic
│   ├── index.ts          # Service exports
│   │
│   ├── documentLoader/    # JSON-LD & DID document loading
│   │   ├── index.ts      # Main document loader with caching
│   │   ├── ttlCache.ts   # TTL cache implementation
│   │   ├── didresolver.ts # DID resolver setup (did:web, did:key)
│   │   └── context/       # Static context storage
│   │       ├── index.ts                    # Context map
│   │       ├── presentation-submission.ts  # Presentation context
│   │       └── status-list-2021.ts        # Status list context
│   │
│   ├── fetch/            # HTTP fetching utilities
│   │   └── index.ts     # JSON-LD/JWT/IPFS fetch helpers
│   │
│   └── verifier/         # Verification services (CORE)
│       ├── index.ts      # Main Verifier class (JSON-LD)
│       ├── jwt.ts        # JWTService for VC-JWT verification
│       ├── gs1.ts        # GS1Verifier with rules integration
│       ├── status.ts     # Status checking (revocation, suspension)
│       ├── schemas.ts    # JSON Schema loading/caching
│       └── schemas/      # GS1 JSON schemas (*.json)
│
└── utils/
    └── crypto.ts         # Cryptographic utilities (key extraction)
```

### Build Output (`/api/dist`)

TypeScript compiled output mirroring `/src` structure. Generated by `tsc`.

### Testing (`/api/__tests__`)

```
__tests__/
├── credential.test.ts       # Credential verification tests
├── presentation.test.ts     # Presentation verification tests
├── jwt.test.ts             # JWT verification tests
├── es256-json-ld.test.ts   # ES256 suite tests
└── gs1.test.ts             # GS1 verification tests
```

### Configuration Files

- `package.json` - Dependencies, scripts, ES module type
- `tsconfig.json` - TypeScript config (ES2022, strict mode)
- `jest.config.ts` - Jest test configuration
- `Dockerfile` - API container build

## Frontend Subproject (`/frontend`)

### Source Code (`/frontend/src`)

```
frontend/src/
├── main.js                 # Vue app initialization
├── App.vue                 # Root component (router-view only)
├── api.js                  # Axios instance configuration
├── utils.js                # Utility functions
├── pdf.js                  # PDF generation utilities
│
├── layouts/               # Layout wrappers
│   └── DefaultLayout.vue  # Standard layout with header/footer
│
├── views/                 # Page components (route targets)
│   ├── Entry.vue         # Landing page (credential selection)
│   ├── Verify.vue        # Verification results display
│   └── PresentationRequest.vue # Presentation request handler
│
├── components/            # Reusable components
│   ├── Credential.vue        # Single credential display
│   ├── Passport.vue          # Product passport wrapper
│   ├── ProductPassport.vue   # Product passport details
│   ├── MergedProps.vue       # Merged credential properties
│   ├── TrimmedBatch.vue      # Batch number display
│   ├── AuthModal.vue         # Authentication modal
│   ├── DiscloseModal.vue     # Disclosure modal
│   ├── QRModal.vue           # QR code modal
│   ├── ScanModal.vue         # QR scanner modal
│   └── PresentationRequest.vue # Presentation request component
│
├── router/
│   └── index.js          # Vue Router configuration
│
├── store/                # Vuex state management
│   ├── index.js         # Main store (verifiables, auth)
│   └── demoAuth.js      # Demo authentication module
│
├── styles/              # Global styles
│   ├── style.scss       # Main stylesheet
│   └── _variables.scss  # SCSS variables
│
└── assets/
    └── img/             # Images (logo, backgrounds)
```

### Build Output (`/frontend/dist`)

Production build generated by Vue CLI (`npm run build`).

### Public Assets (`/frontend/public`)

Static files copied as-is to dist:
- Favicon variants (multiple sizes/formats)
- PWA icons (Android, iOS)
- `manifest.json` - PWA manifest
- `index.html` - HTML template

### Configuration Files

- `package.json` - Dependencies, Vue CLI scripts
- `vue.config.js` - Vue CLI configuration
- `babel.config.js` - Babel transpilation config
- `jest.config.js` - Jest unit test config
- `cypress.json` - Cypress E2E test config
- `jsconfig.json` - JavaScript IDE config
- `Dockerfile` - Frontend container build (nginx)

## Docker Setup

### `docker-compose.yml`

Orchestrates both services:
- `api` service (port 3000)
- `frontend` service (port 80)

Each uses pre-built images from GitHub Container Registry.

### Individual Dockerfiles

- `/api/Dockerfile` - Node.js API container
- `/frontend/Dockerfile` - Nginx-based frontend container

## Development Notes

### Routing Patterns (API)

**Pattern**: `routers/` → `routes/` separation
- **Routers**: Express Router instances, route definitions
- **Routes**: Class-based handlers with business logic
- Example: `routers/verify/index.ts` defines endpoints, imports `routes/verify/index.ts` VerifyRoutes class

### API Endpoints

```
GET  /health           # Health check (Kubernetes probes)
GET  /ready            # Readiness check
GET  /api/verifier/vc/:vcid           # Verify credential by ID
POST /api/verifier                    # Verify array of verifiables
GET  /api/verifier/id/:subjectId     # Verify subject's credentials
POST /api/verifier/gs1                # GS1-specific verification
GET  /api/verifier/swagger            # Swagger UI
```

### Frontend Routing

```
/              # Entry page (credential input)
/verify        # Verification results
/request       # Presentation request handling
```

Uses Vue Router with hash history (`createWebHashHistory`).

### Module Systems

**API**: ES2022 modules
- `"type": "module"` in package.json
- `.js` extensions in imports (even from `.ts` files)
- Top-level await support

**Frontend**: Vue CLI default (CommonJS + ES modules)
- Standard Vue.js module system
- Tree-shaking enabled

## File Naming Conventions

### API
- **TypeScript source**: `.ts` extension
- **Imports**: Use `.js` extension (ES module requirement)
- **Tests**: `*.test.ts` pattern
- **Build output**: Mirrors source structure in `/dist`

### Frontend
- **Components**: PascalCase (e.g., `Credential.vue`)
- **Views**: PascalCase (e.g., `Verify.vue`)
- **Utilities**: camelCase (e.g., `api.js`, `utils.js`)
- **Styles**: SCSS with underscore prefix for partials (`_variables.scss`)

## Key Folders by Feature

### Credential Verification
- API: `api/src/services/verifier/`
- Frontend: `frontend/src/components/Credential.vue`

### Document Loading & Caching
- API: `api/src/services/documentLoader/`

### GS1 Integration
- API: `api/src/services/verifier/gs1.ts`, `schemas/`
- Frontend: Handled transparently via API

### Product Passports
- Frontend: `frontend/src/components/ProductPassport.vue`, `Passport.vue`

### Authentication & Disclosure
- Frontend: `frontend/src/components/AuthModal.vue`, `DiscloseModal.vue`
- Store: `frontend/src/store/demoAuth.js`

## CI/CD Structure

GitHub Actions workflows (`.github/workflows/`):
- `tests.yml` - Run API tests
- `build-all.yml` - Build and push Docker images

Built images pushed to GitHub Container Registry:
- `ghcr.io/european-epc-competence-center/vc-verifier/vc_verifier_api`
- `ghcr.io/european-epc-competence-center/vc-verifier/vc_verifier_frontend`
